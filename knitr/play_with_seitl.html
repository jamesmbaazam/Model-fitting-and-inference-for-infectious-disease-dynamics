<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Modelling interlude: Tristan da Cunha outbreak &amp; the SEITL model.</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="github-pandoc.css" type="text/css" />
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<body>
<div id="header">
<h1 class="title">Modelling interlude: Tristan da Cunha outbreak &amp; the SEITL model.</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#objectives">Objectives</a></li>
<li><a href="#tristan-da-cunha-outbreak">Tristan da Cunha outbreak</a></li>
<li><a href="#seitl-model">SEITL model</a><ul>
<li><a href="#parameter-values-and-initial-state">Parameter values and initial state</a></li>
</ul></li>
<li><a href="#deterministic-vs-stochastic-simulations">Deterministic vs Stochastic simulations</a><ul>
<li><a href="#deterministic-simulations">Deterministic simulations</a></li>
<li><a href="#stochastic-simulations">Stochastic simulations</a></li>
</ul></li>
<li><a href="#exponential-vs-erlang-distributions">Exponential vs Erlang distributions</a></li>
<li><a href="#going-further">Going further</a></li>
</ul>
</div>
<h1 id="objectives">Objectives</h1>
<p>This session will focus on modelling rather than fitting (don't worry, we will come back to fitting on the next session). The aim of this session is to familiarise yourselves with a real data set: the Tristan da Cunha outbreak and a new model called SEITL. We felt this session was necessary as we will use this dataset and this model as a toy example to illustrate all the concepts and methods from now until the end of the course.</p>
<p>As you will read below, the SEITL model has been proposed as a mechanistic explanation for a two-wave influenza A/H3N2 epidemic that occurred on the remote island of Tristan da Cunha in 1971. Given the small population size of this island (284 inhabitants), random effects at the individual level may have had important consequences at the population level. For instance, even if the distribution of the infectious period is the same for all islanders, some islanders will stay infectious longer than others just by chance and might therefore produce more secondary cases. This phenomenon is called <em>demographic stochasticity</em> and it could have played a significant role in the dynamics of the epidemic on Tristan da Cunha.</p>
<p>Unsurprisingly, to account for demographic stochasticity we need a stochastic model. However, as you will see in this session and the following, simulating and fitting a stochastic model is much more computationally costly than doing so for a deterministic model. This is why it is important to understand when and why you need to use stochastic or deterministic models. In fact, we hope that by the end of the day you'll be convinced that both approaches are complementary.</p>
<p>Finally, because this session is devoted to modelling rather than fitting, we thought it was useful to show you how you can make your model biologically more realistic by using distributions for the time spent in each compartment that are more realistic than the exponential distribution.</p>
<p>In brief, in this session you will:</p>
<ol style="list-style-type: decimal">
<li>Familiarise yourselves with the structure of the SEITL model and try to guess its parameter values from the literature.</li>
<li>Compare deterministic and stochastic simulations in order to explore the role of demographic stochasticity in the dynamics of the SEITL model.</li>
<li>Use a more realistic distribution for the time spent in one of the compartment and assess its effect on the shape of the epidemic.</li>
</ol>
<p>But first of all, let's have a look at the data.</p>
<h1 id="tristan-da-cunha-outbreak">Tristan da Cunha outbreak</h1>
<div class="figure">
<img src="figure/import/TdC.png" />
</div>
<p><a href="http://en.wikipedia.org/wiki/Tristan_da_Cunha">Tristan da Cunha</a> is a volcanic island in the South Atlantic Ocean. It has been inhabited since the <span class="math">\(19^{th}\)</span> century and in 1971, the 284 islanders were living in the single village of the island: Edinburgh of the Seven Seas. Whereas the internal contacts were typical of close-knit village communities, contacts with the outside world were infrequent and mostly due to fishing vessels that occasionally took passengers to or from the island. These ships were often the cause of introduction of new diseases into the population. As for influenza, no outbreak had been reported since an epidemic of A/H1N1 in 1954. In this context of a small population with limited immunity against influenza, an unusual epidemic occurred in 1971, 3 years after the global emergence of the new subtype A/H3N2.</p>
<p>On August 13, a ship returning from Cape Town landed five islanders on Tristan da Cunha. Three of them had developed acute respiratory disease during the 8-day voyage and the other two presented similar symptoms immediately after landing. Various family gatherings welcomed their disembarkation and in the ensuing days an epidemic started to spread rapidly throughout the whole island population. After three weeks of propagation, while the epidemic was declining, some islanders developed second episodes of illness and a second peak of cases was recorded. The epidemic faded out after this second wave and lasted a total of 59 days. Despite the lack of virological data, serological evidence indicates that all episodes of illness were due to influenza A/H3N2.</p>
<p>Among the 284 islanders, 273 (96%) experienced at least one episode of illness and 92 (32%) experienced two, which is remarkable for influenza. Unfortunately, only 312 of the 365 attacks (85%) are known to within a single day of accuracy and constitute the dataset reported by <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2130434/">Mantle &amp; Tyrrell in 1973</a>.</p>
<p>The dataset of daily incidence can be loaded and plotted as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(FluTdC1971)
<span class="kw">head</span>(FluTdC1971)
##         date time obs
## 1 1971-08-13    1   0
## 2 1971-08-14    2   1
## 3 1971-08-15    3   0
## 4 1971-08-16    4  10
## 5 1971-08-17    5   6
## 6 1971-08-18    6  32

<span class="co"># plot daily observed incidence</span>
<span class="kw">plotTraj</span>(<span class="dt">data =</span> FluTdC1971)</code></pre>
<p><img src="figure/SEITL_model/data.png" title="" alt="" width="500" style="display: block; margin: auto;" /></p>
<h1 id="seitl-model">SEITL model</h1>
<p>One possible explanation for the rapid influenza reinfections reported during this two-wave outbreak is that following recovery from a first infection, some islanders did not develop long-term protective immunity and remained fully susceptible to reinfection by the same influenza strain that was still circulating. This can be modelled as follows:</p>
<div class="figure">
<img src="figure/import/SEITL.png" alt="The SEITL model extends the classical SIR model to account for the dynamics and host heterogeneity of the immune response among the islanders. Following recovery, hosts remain temporarily protected against reinfection thanks to the cellular immune response (T-cells). Accordingly, they enter the T stage (temporary protection). Then, following down-regulation of the cellular response, the humoral immune response (antibodies) has a probability \alpha to reach a level sufficient to protect against reinfection. In this case, recovered hosts enter the L stage (long-term protection), but otherwise they remain unprotected and re-enter the susceptible pool (S)." /><p class="caption">The SEITL model extends the classical SIR model to account for the dynamics and host heterogeneity of the immune response among the islanders. Following recovery, hosts remain temporarily protected against reinfection thanks to the cellular immune response (T-cells). Accordingly, they enter the T stage (temporary protection). Then, following down-regulation of the cellular response, the humoral immune response (antibodies) has a probability <span class="math">\(\alpha\)</span> to reach a level sufficient to protect against reinfection. In this case, recovered hosts enter the L stage (long-term protection), but otherwise they remain unprotected and re-enter the susceptible pool (S).</p>
</div>
<p>The SEITL model can be described with five states (S, E, I, T and L) and five parameters:</p>
<ol style="list-style-type: decimal">
<li>basic reproductive number (<span class="math">\(R_0\)</span>)</li>
<li>latent period (<span class="math">\(D_\mathrm{lat}\)</span>)</li>
<li>infectious period (<span class="math">\(D_\mathrm{inf}\)</span>)</li>
<li>temporary-immune period (<span class="math">\(D_\mathrm{imm}\)</span>)</li>
<li>probability of developing a long-term protection (<span class="math">\(\alpha\)</span>).</li>
</ol>
<p>and the following deterministic equations:</p>
<p><span class="math">\[
\begin{cases}
\begin{aligned}
\frac{dS}{dt} &amp;= - \beta S \frac{I}{N} + (1-\alpha) \tau T\\
\frac{dE}{dt} &amp;= \beta S \frac{I}{N} - \epsilon E\\
\frac{dI}{dt} &amp;= \epsilon E - \nu I\\
\frac{dT}{dt} &amp;= \nu I - \tau T\\
\frac{dL}{dt} &amp;= \alpha \tau T\\
\end{aligned}
\end{cases}
\]</span></p>
<p>where <span class="math">\(\beta=R_0/D_\mathrm{inf}\)</span>, <span class="math">\(\epsilon=1/D_\mathrm{lat}\)</span>, <span class="math">\(\nu = 1/D_\mathrm{inf}\)</span>, <span class="math">\(\tau=1/D_\mathrm{imm}\)</span> and <span class="math">\(N = S + E + I + L + T\)</span> is constant.</p>
<p>As you saw in the lecture, there is an analogy between the deterministic equations and the algorithm that performs stochastic simulations of the model. In that sense, the deterministic equations are a description of the stochastic model, too.</p>
<p>In order to fit the SEITL model to the Tristan da Cunha dataset we need to add one state variable and one parameter to the model:</p>
<ul>
<li>The dataset represents daily incidence counts: we need to create a <span class="math">\(6^\mathrm{th}\)</span> state variable - called <span class="math">\(\mathrm{Inc}\)</span> - to track the daily number of new cases. Assuming that new cases are reported when they become symptomatic and infectious, we have the following equation for the new state variable: <span class="math">\[
\frac{d\mathrm{Inc}}{dt} = \epsilon E
\]</span></li>
<li>The dataset is incomplete: only 85% of the cases were reported. In addition, we need to account for potential under-reporting of asymptomatic cases. We assume that the data were reported according to a Poisson process with reporting rate <span class="math">\(\rho\)</span>. Since this reporting rate is unknown (we can only presume that it should be below 85% due to reporting errors) we will include it as an additional parameter.</li>
</ul>
<p>The deterministic and stochastic SEITL models are already implemented as two <code>fitmodel</code> objects called <code>SEITL_deter</code> and <code>SEITL_stoch</code> respectively. These can be loaded into your <strong>R</strong> session by typing:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(SEITL_deter)
<span class="kw">data</span>(SEITL_stoch)</code></pre>
<p>A brief technical note: You might be confused that we use a function called <code>data</code> to load a <code>fitmodel</code>. However, this was the only way to provide you with models that preserved comments in the code of the function. Type <code>SEITL_deter$simulate</code>, for instance.</p>
<p><strong>Take a few minutes</strong> to look at the different elements of both models. In particular, you might be interested in how the daily incidence is computed in the function <code>SEITL_deter$simulate</code> and how the likelihood function <code>SEITL_deter$pointLogLike</code> accounts for under-reporting.</p>
<p>You should also notice that <code>SEITL_stoch</code> mainly differs from <code>SEITL_deter</code> through the <code>simulate</code> function, which replaces the deterministic equations solver by a stochastic simulation algorithm. More precisely, this algorithm needs a list of transitions (<code>SEITL_transitions</code>) and a function to compute the transition rate (<code>SEITL_rateFunc</code>). Make sure you understand all the transitions and rates and see the analogy with the deterministic equations.</p>
<p>If you are curious about how the stochastic model is simulated, you can have a look at the code of the function <code>simulateModelStochastic</code>. You will note that it calls the function <code>ssa.adaptivetau</code> of the <strong>R</strong> package <code>adaptivetau</code>, and then processes the returned data frame in order to extract the state of the model at the desired observation times given by <code>times</code>.</p>
<p>However, before doing any simulation, we need some parameter values and initial state for the model.</p>
<h2 id="parameter-values-and-initial-state">Parameter values and initial state</h2>
<p>Based on the description of the outbreak above and the information below found in the literature, can you think of one or more set(s) of values for the parameters (<code>theta</code>) and initial state (<code>init.state</code>) of the model?</p>
<ol style="list-style-type: decimal">
<li>The <span class="math">\(R_0\)</span> of influenza is commonly estimated to be around 2. However, it can be significantly larger in close-knit communities with exceptional contact configurations.</li>
<li>Both the average latent and infectious periods for influenza have been estimated around 2 days each.</li>
<li>The down-regulation of the cellular response is completed on average 15 days after symptom onset.</li>
<li>Serological surveys have shown that the seroconversion rate to influenza (probability of developing antibodies) is around 80%. However, it is likely that <strong>not</strong> all seroconverted individuals acquire a long-term protective against reinfection.</li>
<li>Between 20 and 30% of the infections with influenza are asymptomatic.</li>
<li>There is very limited cross-immunity between influenza viruses A/H1N1 and A/H3N2.</li>
</ol>
<h1 id="deterministic-vs-stochastic-simulations">Deterministic vs Stochastic simulations</h1>
<p>Now, try to assess whether the SEITL model can reproduce the two-wave outbreak of Tristan da Cunha with your guess values for the initial state and the parameters. This will give you the opportunity to compare the deterministic and stochastic model. Here we propose to start with the deterministic model and then move on to the stochastic model but feel free to proceed in a different way. Of course, if you don't like to guess parameter values, you can still use <a href="play_with_seitl_example.html#parameter-values-and-initial-state">ours</a>.</p>
<h2 id="deterministic-simulations">Deterministic simulations</h2>
<p>You can use the <code>plotFit</code> function you encountered in the <a href="introduction.html#assess-the-model-fit">first practical</a> to generate an observation trajectory and display it against the data:</p>
<pre class="sourceCode r"><code class="sourceCode r">theta.bad.guess &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">R0 =</span> <span class="dv">2</span>, <span class="dt">D.lat =</span> <span class="dv">2</span>, <span class="dt">D.inf =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>, <span class="dt">D.imm =</span> <span class="dv">13</span>, 
    <span class="dt">rho =</span> <span class="fl">0.85</span>)
init.state.bad.guess &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">S =</span> <span class="dv">250</span>, <span class="dt">E =</span> <span class="dv">0</span>, <span class="dt">I =</span> <span class="dv">4</span>, <span class="dt">T =</span> <span class="dv">0</span>, <span class="dt">L =</span> <span class="dv">30</span>, <span class="dt">Inc =</span> <span class="dv">0</span>)
<span class="kw">plotFit</span>(SEITL_deter, theta.bad.guess, init.state.bad.guess, <span class="dt">data =</span> FluTdC1971)</code></pre>
<p><img src="figure/SEITL_model/oneTraj.png" title="" alt="" width="500" style="display: block; margin: auto;" /></p>
<p>You can display all states variables (not only the sampled observations) by passing <code>all.vars=TRUE</code> to the <code>plotFit</code> function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotFit</span>(SEITL_deter, theta.bad.guess, init.state.bad.guess, <span class="dt">data =</span> FluTdC1971, 
    <span class="dt">all.vars =</span> <span class="ot">TRUE</span>)</code></pre>
<p><img src="figure/SEITL_model/allVars.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<p>Note that although the simulation of the trajectory is deterministic, the observation process is stochastic, hence the noisy <code>obs</code> time-series. You can appreciate the variability of the observation process by plotting several replicates (use the argument <code>n.replicates</code>):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotFit</span>(SEITL_deter, theta.bad.guess, init.state.bad.guess, <span class="dt">data =</span> FluTdC1971, 
    <span class="dt">n.replicates =</span> <span class="dv">100</span>)</code></pre>
<p><img src="figure/SEITL_model/manyObs.png" title="" alt="" width="500" style="display: block; margin: auto;" /></p>
<p>By default, this function plots the mean and the median as well as the <span class="math">\(95^\mathrm{th}\)</span> and <span class="math">\(50^\mathrm{th}\)</span> percentiles of the replicated simulations. Alternatively, you can visualise all the simulated trajectories by passing <code>summary=FALSE</code> to the <code>plotFit</code> function:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotFit</span>(SEITL_deter, theta.bad.guess, init.state.bad.guess, <span class="dt">data =</span> FluTdC1971, 
    <span class="dt">n.replicates =</span> <span class="dv">100</span>, <span class="dt">summary =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="figure/SEITL_model/allTraj.png" title="" alt="" width="500" style="display: block; margin: auto;" /></p>
<p>Now, <strong>take 10 minutes</strong> to explore the dynamics of the model for different parameter and initial state values. In particular, try different values for <span class="math">\(R_0\in[2-15]\)</span> and <span class="math">\(\alpha\in[0.3-1]\)</span>. For which values of <span class="math">\(R_0\)</span> and <span class="math">\(\alpha\)</span> do you get a decent fit?</p>
<p>If you didn't manage to get the two waves, you can have look at <a href="play_with_seitl_example.html#deterministic-simulations">our example</a>.</p>
<p>You should find that it is hard to capture all the data-point with the deterministic model. We will now test if this can be better reproduced with a stochastic model which explicitly accounts for the discrete nature of individuals.</p>
<h2 id="stochastic-simulations">Stochastic simulations</h2>
<p><strong>Take about 10 minutes</strong> to explore the dynamics of the stochastic SEITL model with the function <code>plotFit</code>. Note that <code>SEITL_stoch</code> has the same <code>theta.names</code> and <code>state.names</code> as <code>SEITL_deter</code>, which means that you can use the same parameters and initial state vectors as in the previous section. In addition, you might find useful to plot the time-series of the extinction probability (i.e. the proportion of faded out simulations) by passing <code>p.extinction=TRUE</code> to <code>plotFit</code>.</p>
<p>What differences do you notice between stochastic and deterministic simulations? Can you make any conclusions on the role of demographic stochasticity on the dynamics of the SEITL model? Otherwise you can have a look at <a href="play_with_seitl_example.html#stochastic-simulations">our example</a>.</p>
<p>Now, let's try to make this model a bit more realistic.</p>
<h1 id="exponential-vs-erlang-distributions">Exponential vs Erlang distributions</h1>
<p>So far, we have assumed that the time spent in each compartment follows an <a href="http://en.wikipedia.org/wiki/Exponential_distribution">exponential distribution</a>, because by assuming transitions happen at constant rates we have implied that the process is <a href="http://en.wikipedia.org/wiki/Memorylessness">memoryless</a>. Although mathematically convenient, this property is not realistic for many biological processes such as the contraction of the cellular response. In order to include a memory effect, it is common practice to replace the exponential distribution by an <a href="http://en.wikipedia.org/wiki/Agner_Krarup_Erlang#mediaviewer/File:Erlang.jpg">Erlang distribution</a>. This distribution is parametrised by its mean <span class="math">\(m\)</span> and shape <span class="math">\(k\)</span> and can be modelled by <span class="math">\(k\)</span> consecutive sub-stages, each being exponentially distributed with mean <span class="math">\(m/k\)</span>. As illustrated below the flexibility of the Erlang distribution ranges from the exponential (<span class="math">\(k=1\)</span>) to Gaussian-like (<span class="math">\(k&gt;&gt;1\)</span>) distributions.</p>
<p><img src="figure/SEITL_model/erlang.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<p>We can extend the SEITL as follows:</p>
<div class="figure">
<img src="figure/import/SEIT2L.png" alt="The SEIT2L model extends the SEITL model to account for memory effect in the contraction of the cellular response. The time spent in the T compartment (temporary protection) follows an Erlang distribution with mean D_\mathrm{imm}=1/\tau and shape equal to 2 and is modelled by 2 sub-stages T_1 and T_2, each being exponentially distributed with mean equal to \frac{D_\mathrm{imm}}{2}." /><p class="caption">The SEIT2L model extends the SEITL model to account for memory effect in the contraction of the cellular response. The time spent in the <span class="math">\(T\)</span> compartment (temporary protection) follows an Erlang distribution with mean <span class="math">\(D_\mathrm{imm}=1/\tau\)</span> and shape equal to 2 and is modelled by 2 sub-stages <span class="math">\(T_1\)</span> and <span class="math">\(T_2\)</span>, each being exponentially distributed with mean equal to <span class="math">\(\frac{D_\mathrm{imm}}{2}\)</span>.</p>
</div>
<p>The deterministic and stochastic SEIT2L models are already implemented as <code>fitmodel</code> objects, which can be loaded into your <strong>R</strong> session by typing:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(SEIT2L_deter)
<span class="kw">data</span>(SEIT2L_stoch)</code></pre>
<p><strong>Take 5 minutes</strong> to have a look at the function <code>simulate</code> of these SEIT2L models and make sure you understand how the Erlang distribution for the <span class="math">\(T\)</span> compartment is coded.</p>
<p>Now, compare the dynamics of the SEITL and SEIT2L model using <code>plotFit</code>. Use your best guess from the previous section as well as stochastic and deterministic simulations. Note that although SEITL and SEIT2L share the same parameters, their state variables differ so you need to modify the <code>init.state</code> of SEIT2L accordingly.</p>
<p>Can you notice any differences? If so, which model seems to provide the best fit? Do you understand why the shape of the epidemic changes when you use the Erlang distribution of the <span class="math">\(T\)</span> compartment?</p>
<p>Again, feel free to can have a look at <a href="play_with_seitl_example.html#exponential-vs-erlang-distributions">our example</a>.</p>
<p>In the next session, you will verify your intuition by using a statistical criterion to find which model fits the best the Tristan da Cunha outbreak.</p>
<h1 id="going-further">Going further</h1>
<ul>
<li>Curious about why we use the Poisson likelihood for count data? Have a look at the bottom of page 3 of this <a href="http://data.princeton.edu/wws509/notes/c4.pdf">reference</a>.</li>
<li>You might wonder why we only modified the distribution of the <span class="math">\(T\)</span> compartment. Indeed, wouldn't it be more realistic to use Erlang distributions for all the other compartments? And why did we use a shape equal to 2 and not 5 or 100? Think about another variant of the SEITL model and implement it by modifying the original version in a similar way as we did for the SEIT2L model. Does it fit the data better?</li>
</ul>
<div>
<h1>Navigate</h1>
Previous: <a href="mcmc_diagnostics.html">MCMC diagnostics</a> Next: <a href="mcmc_and_model_comparison.html">MCMC and model comparison</a>
</div>
</body>
</html>
