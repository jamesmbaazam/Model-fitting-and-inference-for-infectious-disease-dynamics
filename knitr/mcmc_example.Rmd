Below, you can find an example of how to code a Metropolis sampler. Some bits are left out for you to fill in (marked "INSERT HERE"). Each "INSERT HERE" statement requires one line of code. If you struggle, you can find a link to the solution below the function.

```{r eval = FALSE}
# This is a function that takes four parameters:
# - target.dist: the target distribution, a function that takes one
#   argument (a number) and returns the (logged) value of a
#   distribution
# - theta.init: the initial value of theta, a number
# - proposal.sd: the standard deviation of (Gaussian) proposal
#   distribution
# - n.iterations: the number of iterations
# The function returns a vector of samples of theta from the target
# distribution
my_mcmcMH <- function(target, init.theta, covmat.proposal, n.iterations) {

    # evaluate the function "target.dist" at "theta.init", and assign to
    # a variable called target.theta.current.
    target.theta.current <- target.dist(init.theta)

    # initialise variables to store the current value of theta, the
    # vector of samples, and the number of accepted runs
    theta.current <- theta.init
    samples <- theta.init
    accepted <- 0

    ## run MCMC for n.iteration interations
    for (i.iteration in seq_len(n.iterations)) {

        theta.proposed <- # INSERT HERE: draw a new theta from the
            # (multivariate Gaussian) proposal distribution and assign
            # to a variable called "theta.proposed". See "?nrorm for
            # help.

        target.theta.proposed <- # INSERT HERE: evaluate the function
            # target.dist at the proposed theta and assign to a
            # variable called "target.theta.proposed"

        log.acceptance <- # INSERT HERE: compute Metropolis ratio
            # (acceptance probability). This is easiest if you assume
            # the target function to return the logarithm of the
            # distribution value. Assign the result to a variable
            # called "log.acceptance"

        r <- # INSERT HERE: draw random number number between 0 and 1
            # using "runif" and assign to a variable called "r".

        # test acceptance by comparing the random number to the
        # Metropolis-Hastings ratio (acceptance probability) (using
        # "exp" because we calculated the logarithm of the
        # Metropolis-Hastings ratio before)
        if (r < exp(log.acceptance)) {

            # if accepted:
            theta.current <- # INSERT HERE: change the current value
                # of theta to the proposed theta

            target.theta.current <- # INSERT HERE: updated the current
                # value of the target

            # update number of accepted proposals
            accepted <- accepted + 1

        }

        # add the current theta to the vector of samples
        samples <- c(samples, theta.current)

        # print current state of chain and acceptance rate
        cat("chain:", theta.current,
            "acceptance rate:", accepted / i.iteration, "\n")

    }

    return(samples)
}
```

If you run into any problems, have a look at our [solution](mcmc_example_solution.md).
